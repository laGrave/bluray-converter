# BluRay Converter - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã BluRay Converter.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å](#–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π-—Ä–∞–±–æ—á–∏–π-–ø—Ä–æ—Ü–µ—Å—Å)
2. [–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å](#–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
3. [–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å–º–æ–≤](#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-—Ñ–∏–ª—å–º–æ–≤)
4. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–ø—Ä–æ–≥—Ä–µ—Å—Å–∞)
5. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∑–∞–¥–∞—á–∞–º–∏)
6. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-telegram)
7. [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ-api)
8. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Ñ–∞–π–ª–∞–º–∏)
9. [–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã](#–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ-—Å–∏—Å—Ç–µ–º—ã)
10. [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏)

## –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

### –¢–∏–ø–∏—á–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```mermaid
graph TD
    A[–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å BluRay –Ω–∞ NAS] --> B[–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ 3 —É—Ç—Ä–∞]
    B --> C[–°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞]
    C --> D[Mac –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ]
    D --> E[–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram]
    E --> F[–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –ø–∞–ø–∫—É Processed]
    F --> G[–†—É—á–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É Plex]
```

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∏–ª—å–º–æ–≤
–ü–æ–º–µ—Å—Ç–∏—Ç–µ –ø–∞–ø–∫–∏ BluRay –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Å—ã—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤:
```
/volume1/video/–ö–∏–Ω–æ/BluRayRAW/
‚îî‚îÄ‚îÄ –ù–æ–≤—ã–π –§–∏–ª—å–º (2023)/
    ‚îî‚îÄ‚îÄ BDMV/
        ‚îú‚îÄ‚îÄ PLAYLIST/
        ‚îú‚îÄ‚îÄ STREAM/
        ‚îî‚îÄ‚îÄ CLIPINF/
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –°–∏—Å—Ç–µ–º–∞ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3 —É—Ç—Ä–∞ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- –ù–æ–≤—ã–µ —Ñ–∏–ª—å–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–∞ Mac mini
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ —á–µ—Ä–µ–∑ Telegram

### 3. –†—É—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- –ü–µ—Ä–µ–º–µ—â–∞–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É Plex
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ—à–∏–±–∫–∞–º–∏

## –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–î–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É: `http://your-nas-ip:8081`

### Dashboard Overview
- **Task Queue**: Current and pending tasks
- **System Status**: Health of all services
- **Statistics**: Processing history and stats
- **Recent Activity**: Latest operations

### Main Features

#### Task Management
- View all tasks with status
- Restart failed tasks
- Set task priorities
- Cancel running tasks

#### Manual Controls
- **Scan Directory**: Trigger immediate scan
- **Process Queue**: Force processing start
- **Clear Completed**: Remove finished tasks

#### System Information
- Service health status
- Resource usage
- Recent error logs
- System configuration

## Adding Movies

### Supported Formats
The system processes BluRay disc images with this structure:
```
Movie Name (Year)/
‚îî‚îÄ‚îÄ BDMV/
    ‚îú‚îÄ‚îÄ PLAYLIST/
    ‚îÇ   ‚îú‚îÄ‚îÄ 00000.mpls  # Menu playlist
    ‚îÇ   ‚îú‚îÄ‚îÄ 00001.mpls  # Main movie (longest)
    ‚îÇ   ‚îî‚îÄ‚îÄ 00002.mpls  # Extras
    ‚îú‚îÄ‚îÄ STREAM/
    ‚îÇ   ‚îú‚îÄ‚îÄ 00000.m2ts  # Video streams
    ‚îÇ   ‚îî‚îÄ‚îÄ 00001.m2ts
    ‚îî‚îÄ‚îÄ CLIPINF/
        ‚îú‚îÄ‚îÄ 00000.clpi  # Clip info
        ‚îî‚îÄ‚îÄ 00001.clpi
```

### File Naming Conventions
Use clear, descriptive names:
- ‚úÖ `The Matrix (1999)`
- ‚úÖ `Blade Runner 2049 (2017)`
- ‚ùå `movie1`
- ‚ùå `BluRay_Backup`

### Directory Structure
```
/volume1/video/–ö–∏–Ω–æ/
‚îú‚îÄ‚îÄ BluRayRAW/          # Drop new movies here
‚îÇ   ‚îú‚îÄ‚îÄ Movie A (2023)/
‚îÇ   ‚îî‚îÄ‚îÄ Movie B (2022)/
‚îú‚îÄ‚îÄ BluRayProcessed/    # System outputs here
‚îÇ   ‚îú‚îÄ‚îÄ Movie A (2023).mkv
‚îÇ   ‚îî‚îÄ‚îÄ Movie B (2022).mkv
‚îî‚îÄ‚îÄ BluRayTemp/         # Temporary processing
    ‚îî‚îÄ‚îÄ (automatic cleanup)
```

## Monitoring Progress

### Web Interface Monitoring
1. Open `http://your-nas-ip:8081`
2. Check the **Tasks** section
3. Monitor **Status** column:
   - üü° **Pending**: Waiting to be processed
   - üîµ **Sent**: Sent to Mac mini
   - üü† **Processing**: Currently converting
   - üü¢ **Completed**: Successfully processed
   - üî¥ **Failed**: Error occurred

### Task Details
Click on any task to see:
- Processing start/end times
- Current progress percentage
- Error messages (if failed)
- File sizes and locations

### Real-time Updates
The web interface updates automatically every 30 seconds.

## Managing Tasks

### Task Statuses
- **pending**: Waiting in queue
- **sent**: Dispatched to worker
- **processing**: Currently being converted
- **completed**: Successfully finished
- **failed**: Error occurred
- **retrying**: Automatic retry in progress

### Task Actions

#### Restart Failed Tasks
1. Navigate to failed task
2. Click **Restart** button
3. Task returns to **pending** status

#### Priority Processing
1. Select important task
2. Click **Set Priority**
3. Task moves to front of queue

#### Cancel Tasks
1. Find running task
2. Click **Cancel**
3. Processing stops, temp files cleaned

### Bulk Operations
- **Restart All Failed**: Retry all failed tasks
- **Clear Completed**: Remove finished tasks from view
- **Scan Directory**: Check for new movies

## Telegram Integration

### Bot Commands
Send these commands to your bot:

#### Information Commands
- `/queue` - Show current task queue
- `/status` - System health status
- `/stats` - Processing statistics
- `/help` - List all commands

#### Control Commands
- `/scan` - Trigger directory scan
- `/cancel` - Cancel current processing
- `/restart <task_id>` - Restart specific task

### Notification Types

#### Processing Started
```
üé¨ Processing started: The Matrix (1999)
Worker: Mac mini
Queue position: 1 of 3
```

#### Processing Completed
```
‚úÖ Completed: The Matrix (1999)
Duration: 45 minutes
Output: 12.3 GB MKV file
Location: BluRayProcessed/
```

#### Error Notifications
```
‚ùå Processing failed: The Matrix (1999)
Error: Invalid BDMV structure
Attempts: 2/3
Next retry: 30 minutes
```

### Notification Settings
Configure in NAS `.env` file:
```bash
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
TELEGRAM_NOTIFICATIONS=true
```

## API Usage

### Base URLs
- **NAS API**: `http://your-nas-ip:8080/api`
- **Mac Worker**: `http://mac-mini-ip:8000/api`

### Common Endpoints

#### Get All Tasks
```bash
curl http://your-nas-ip:8080/api/tasks
```

#### Trigger Scan
```bash
curl -X POST http://your-nas-ip:8080/api/tasks/scan \
  -H "Content-Type: application/json" \
  -d '{"priority": 1}'
```

#### Check System Health
```bash
curl http://your-nas-ip:8080/api/health
```

#### Get Statistics
```bash
curl http://your-nas-ip:8080/api/statistics
```

#### Restart Task
```bash
curl -X POST http://your-nas-ip:8080/api/tasks/123/restart
```

### Response Formats
All API responses use JSON format:
```json
{
  "status": "success",
  "data": {...},
  "message": "Operation completed"
}
```

## File Management

### Automatic File Operations

#### After Successful Processing
1. **Original**: Moved from `BluRayRAW/` to system backup
2. **Converted**: Placed in `BluRayProcessed/`
3. **Temporary**: Cleaned from `BluRayTemp/`

#### File Naming
Output files follow this pattern:
- Input: `Movie Name (2023)/BDMV/`
- Output: `Movie Name (2023).mkv`

### Manual File Management

#### Moving to Plex Library
After processing, manually move files:
```bash
# Example move to Plex library
mv "/volume1/video/–ö–∏–Ω–æ/BluRayProcessed/Movie (2023).mkv" \
   "/volume1/video/Movies/Movie (2023).mkv"
```

#### Cleaning Up
Remove processed originals:
```bash
# Remove original BluRay folder after successful conversion
rm -rf "/volume1/video/–ö–∏–Ω–æ/BluRayRAW/Movie (2023)/"
```

### Storage Management

#### Disk Space Monitoring
- Monitor available space regularly
- Each BluRay: ~25-50GB input, ~15-30GB output
- Keep 100GB+ free for processing

#### Automatic Cleanup
System automatically cleans:
- Temporary files after completion
- Database records older than 60 days
- Log files when they exceed size limits

## System Maintenance

### Daily Checks
Via Web UI or API:
- ‚úÖ Service health status
- ‚úÖ Task queue status
- ‚úÖ Available disk space
- ‚úÖ Recent error logs

### Weekly Maintenance
```bash
# Check service status
./scripts/test-connection.sh

# Review logs for issues
./scripts/deploy-nas.sh logs
./scripts/deploy-mac.sh logs
```

### Monthly Tasks
```bash
# Update system
git pull origin main
./scripts/deploy-nas.sh
./scripts/deploy-mac.sh

# Backup configuration
tar -czf config-backup.tar.gz nas-services/.env mac-services/.env
```

### Database Maintenance
Automatic cleanup runs weekly, or trigger manually:
```bash
curl -X POST http://your-nas-ip:8080/api/maintenance/cleanup
```

## Best Practices

### Movie Preparation
1. **Verify BDMV structure** before copying
2. **Use descriptive names** with year
3. **Check available space** before adding
4. **Test with one movie** first

### Monitoring
1. **Check Telegram notifications** regularly
2. **Review Web UI** for failed tasks
3. **Monitor disk space** weekly
4. **Backup configurations** monthly

### Performance Optimization
1. **Process one movie at a time** for stability
2. **Schedule scans during low usage** hours
3. **Keep Mac mini powered on** 24/7
4. **Use wired network connection**

### Troubleshooting
1. **Check connection test** first
2. **Review logs** for errors
3. **Restart services** if needed
4. **Use dry-run mode** for testing

### File Organization
```
Recommended Plex structure:
/volume1/video/Movies/
‚îú‚îÄ‚îÄ Action/
‚îÇ   ‚îú‚îÄ‚îÄ The Matrix (1999).mkv
‚îÇ   ‚îî‚îÄ‚îÄ John Wick (2014).mkv
‚îú‚îÄ‚îÄ Drama/
‚îÇ   ‚îî‚îÄ‚îÄ The Shawshank Redemption (1994).mkv
‚îî‚îÄ‚îÄ Sci-Fi/
    ‚îî‚îÄ‚îÄ Blade Runner 2049 (2017).mkv
```

## Common Operations

### Adding Multiple Movies
```bash
# Copy multiple BluRay folders to RAW directory
cp -r "/path/to/bluray/Movie1 (2023)" "/volume1/video/–ö–∏–Ω–æ/BluRayRAW/"
cp -r "/path/to/bluray/Movie2 (2023)" "/volume1/video/–ö–∏–Ω–æ/BluRayRAW/"

# Trigger scan
curl -X POST http://your-nas-ip:8080/api/tasks/scan
```

### Batch Processing
The system processes movies sequentially by default. To view queue:
```bash
# Check processing queue
curl http://your-nas-ip:8080/api/tasks | jq '.data[] | select(.status=="pending")'
```

### Emergency Stop
```bash
# Stop all processing
curl -X POST http://your-nas-ip:8080/api/tasks/cancel-all

# Or restart entire system
./scripts/reset-system.sh containers
./scripts/deploy-nas.sh
./scripts/deploy-mac.sh
```

## Integration with Plex

### Automatic Library Updates
Consider setting up Plex to automatically scan for new content:
1. Enable **Scan my library automatically** in Plex settings
2. Set scan interval to check for new files
3. Monitor Plex logs for successful imports

### Metadata Management
- Use proper movie naming conventions
- Include year in filename for better matching
- Consider using tools like Filebot for organization

---

**Quick Reference**: Keep this guide bookmarked for daily operations. For setup issues, see [SETUP.md](SETUP.md). For problems, check [TROUBLESHOOTING.md](TROUBLESHOOTING.md).